@use "sass:list";
@use "sass:map";
@use "sass:math";
@use "../utils";
@use "../theme/colors";
@use "../theme/theme";

$disable-everything: false !default;
$disable-auto: false !default;
$disable-full-width: false !default;
$disable-overlay: false !default;
$disable-overlay-top: false !default;
$disable-overlay-right: false !default;
$disable-overlay-bottom: false !default;
$disable-overlay-left: false !default;
$disable-overlay-middle: false !default;
$disable-overlay-center: false !default;
$disable-overlay-absolute-center: false !default;

$selectors: (img ">svg" iframe video embed object) !default;

$overlay-background-color: rgba(colors.$black, 0.54) !default;
$overlay-color: theme.$dark-theme-text-primary-color !default;
$overlay-z-index: 0 !default;
$overlay-padding: 1rem !default;
$overlay-horizontal-width: 30% !default;

$aspect-ratios: (
  "16-9": 16 9,
  "4-3": 4 3,
  "1-1": 1 1,
) !default;

$disable-aspect-ratios: not list.length(map.keys($aspect-ratios)) !default;

@mixin forced-aspect-ratio {
  height: 100%;
  inset: 0;
  position: absolute;
  width: 100%;
}

@mixin aspect-ratio($width, $height) {
  padding-bottom: math.percentage(math.div($height, $width));
}

@mixin base-styles {
  .rmd-responsive-item {
    display: inline-block;
    position: relative;

    @if not $disable-auto {
      &--auto {
        @each $selector in $selectors {
          #{$selector} {
            height: auto;
            width: 100%;
          }
        }
      }
    }

    @if not $disable-full-width {
      &--full-width {
        display: block;
        width: 100%;
      }
    }

    @if not $disable-aspect-ratios {
      &--aspect-ratio {
        display: block;
        height: 0;
        overflow: hidden;
        padding: 0;

        @each $selector in $selectors {
          #{$selector} {
            @include forced-aspect-ratio;
          }
        }
      }

      @each $suffix, $ratio-list in $aspect-ratios {
        &--#{$suffix} {
          @include aspect-ratio(
            list.nth($ratio-list, 1),
            list.nth($ratio-list, 2)
          );
        }
      }
    }
  }
}

@mixin overlay-styles {
  .rmd-responsive-item-overlay {
    background-color: $overlay-background-color;
    color: $overlay-color;
    padding: $overlay-padding;
    position: absolute;
    z-index: $overlay-z-index;

    @if not $disable-overlay-top {
      &--top {
        inset: 0 0 auto;
      }
    }

    @if not $disable-overlay-bottom {
      &--bottom {
        inset: auto 0 0;
      }
    }

    &--horizontal {
      inset: 0 auto;
      width: $overlay-horizontal-width;
    }

    @if not $disable-overlay-left {
      &--left {
        @include utils.auto-rtl(left, 0);
      }
    }

    @if not $disable-overlay-right {
      &--right {
        @include utils.auto-rtl(right, 0);
      }
    }

    @if not $disable-overlay-middle {
      &--middle {
        inset: auto 0 50%;
        transform: translate3d(0, 50%, 0);
      }
    }

    @if not $disable-overlay-center {
      &--center {
        inset: 0 50% 0 auto;
        transform: translate3d(50%, 0, 0);
      }
    }

    @if not $disable-overlay-absolute-center {
      &--absolute-center {
        inset: auto 50% 50% auto;
        transform: translate3d(50%, 50%, 0);
      }
    }
  }
}

@mixin styles($disable-layer: false) {
  @if not $disable-everything {
    @include utils.optional-layer(responsive-item, $disable-layer) {
      @include base-styles;

      @if not $disable-overlay {
        @include overlay-styles;
      }
    }
  }
}
