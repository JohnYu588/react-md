@use "sass:map";
@use "../utils";
@use "../theme/theme";
@use "../box-shadows";
@use "../typography/typography";
@use "../divider/divider";

$disable-everything: false !default;
$disable-bordered: false !default;
$disable-shadowed: false !default;
$disable-raisable: false !default;
$disable-full-width: false !default;
$disable-content-secondary-color: false !default;
$disable-content-last-child-padding: false !default;

$elevation: 2 !default;
$raisable-start-elevation: 1 !default;
$raisable-end-elevation: 8 !default;

$light-theme-background-color: theme.theme-get-var(surface-color) !default;
$dark-theme-background-color: if(
  theme.$disable-dark-elevation,
  theme.$dark-theme-surface-color,
  map.get(theme.$dark-elevation-colors, $elevation)
) !default;

$background-color: theme.get-default-color(
  $light-theme-background-color,
  $dark-theme-background-color
) !default;
$color: theme.theme-get-var(text-primary-color) !default;

$border-color: divider.get-var(color) !default;
$border-width: divider.get-var(size) !default;
$border-radius: 0.25rem !default;

$header-padding: 1rem !default;
$header-padding-top: 1.5rem !default;

$header-spacing: 1rem !default;

$content-padding: 1rem !default;
$content-padding-bottom: 1.5rem !default;

$footer-padding: 0.5rem !default;

$var-lookup: (
  background-color: (
    var: --rmd-card-background-color,
    value: $background-color,
  ),
  color: (
    var: --rmd-card-color,
    value: $color,
  ),
  secondary-color: (
    var: --rmd-card-secondary-color,
    value: null,
  ),
);

@function get-var($name, $fallback: null) {
  $found: utils.validate($var-lookup, $name, "card var");
  $var: map.get($found, var);
  $value: if($fallback, $fallback, map.get($found, value));

  @if $value {
    @return var(#{$var}, #{$value});
  }

  @return var(#{$var});
}

@mixin set-var($name, $value) {
  $var: map.get(utils.validate($var-lookup, $name, "card var"), var);

  #{$var}: #{$value};
}

@mixin use-var($property, $name: $property, $fallback: null) {
  #{$property}: get-var($name, $fallback);
}

@mixin use-light-theme {
  @if not $disable-everything {
    @include set-var(background-color, $light-theme-background-color);
  }
}

@mixin use-dark-theme {
  @if not $disable-everything {
    @include set-var(background-color, $dark-theme-background-color);
  }
}

@mixin styles {
  @if not $disable-everything {
    @include theme.default-system-theme {
      @include use-dark-theme;
    }

    .rmd-card {
      @include use-var(background-color);
      @include use-var(color);

      border-radius: $border-radius;
      display: inline-block;
      max-width: 100%;

      @if not $disable-raisable {
        @include utils.mouse-only {
          &--raisable {
            @include box-shadows.elevation-transition(
              $raisable-start-elevation,
              $raisable-end-elevation,
              "&:hover"
            );
          }
        }
      }

      @if not $disable-shadowed {
        &--shadowed {
          @include box-shadows.box-shadow($elevation);
        }
      }

      @if not $disable-bordered {
        &--bordered {
          border: $border-width inset $border-color;
        }
      }

      @if not $disable-full-width {
        &--full-width {
          display: block;
          width: 100%;
        }
      }

      &__header {
        align-items: center;
        column-gap: $header-spacing;
        display: flex;
        padding: $header-padding-top $header-padding $header-padding;
      }

      &__header-content {
        @include typography.text-overflow;

        flex: 1 1 auto;
        min-width: 1;
      }

      // does not require custom styles
      // &__title {
      // }

      // does not require custom styles
      // &__subtitle {
      // }

      &__content {
        @if not $disable-content-secondary-color {
          &--secondary {
            @include theme.theme-use-var(color, text-secondary-color);
          }
        }

        @if $content-padding {
          &--padded {
            padding: $content-padding;
          }
        }

        @if not $disable-content-last-child-padding {
          &--padded-bottom:last-child {
            padding-bottom: $content-padding-bottom;
          }
        }
      }

      @if $footer-padding {
        &__footer {
          padding: $footer-padding;
        }
      }
    }
  }
}
