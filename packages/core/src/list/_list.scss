@use "sass:map";
@use "../utils";
@use "../theme/theme";
@use "../avatar/avatar";
@use "../icon/icon";
@use "../divider/divider";
@use "../interaction/interaction";
@use "../typography/typography";

$disable-everything: false !default;
$disable-horizontal: false !default;
$disable-item-disabled-color: false !default;
$disable-item-disabled-opacity: false !default;
$disable-item-avatar: false;
$disable-item-media: false !default;
$disable-item-media-large: false !default;
$disable-medium-height: false !default;
$disable-large-height: false !default;
$disable-extra-large-height: false !default;
$disable-three-line-height: false !default;
$disable-item-link-styles: false !default;

$disable-subheader: false !default;
$disable-subheader-inset: false !default;

$item-secondary-text-line-height: 1.42857 !default;
$item-secondary-text-three-line-max-height: 3rem !default;

$vertical-padding: 0.5rem !default;
$dense-vertical-padding: 0.25rem !default;

$horizontal-padding: 0 !default;
$dense-horizontal-padding: $horizontal-padding !default;

$dense-font-size: 0.8125rem !default;
$typography-styles: map.merge(
  typography.$subtitle-1-styles,
  (
    line-height: map.get(typography.$body-1-styles, line-height),
  )
) !default;

$item-disabled-opacity: 0.5 !default;
$item-vertical-padding: 0.5rem !default;
$item-horizontal-padding: 1rem !default;
$item-height: 3rem !default;
$item-dense-height: 2.5rem !default;
$item-medium-height: 3.5rem !default;
$item-dense-medium-height: 3rem !default;
$item-large-height: 4rem !default;
$item-dense-large-height: 3.5rem !default;
$item-extra-large-height: 4.5rem !default;
$item-dense-extra-large-height: 4rem !default;
$item-three-line-height: 5.5rem !default;
$item-dense-three-line-height: 5rem !default;

$item-media-spacing: 1rem !default;
$item-media-size: 3.5rem !default;
$item-media-large-size: 6.25rem !default;

$item-keyline: 4.5rem !default;

$var-lookup: (
  horizontal-padding: (
    var: --rmd-list-padding-h,
    value: $horizontal-padding,
  ),
  vertical-padding: (
    var: --rmd-list-padding-v,
    value: $vertical-padding,
  ),
  item-keyline: (
    var: --rmd-list-item-keyline,
    value: $item-keyline,
  ),
  item-horizontal-padding: (
    var: --rmd-list-item-padding-h,
    value: $item-horizontal-padding,
  ),
  item-vertical-padding: (
    var: --rmd-list-item-padding-v,
    value: $item-vertical-padding,
  ),
  item-height: (
    var: --rmd-list-item-height,
    value: $item-height,
  ),
  item-medium-height: (
    var: --rmd-list-item-medium-height,
    value: $item-medium-height,
  ),
  item-large-height: (
    var: --rmd-list-item-large-height,
    value: $item-large-height,
  ),
  item-extra-large-height: (
    var: --rmd-list-item-extra-large-height,
    value: $item-extra-large-height,
  ),
  item-three-line-height: (
    var: --rmd-list-item-three-line-height,
    value: $item-three-line-height,
  ),
  item-media-size: (
    var: --rmd-list-item-media-size,
    value: $item-media-size,
  ),
  item-media-spacing: (
    var: --rmd-list-item-media-spacing,
    value: $item-media-spacing,
  ),
  text-three-line-height: (
    var: --rmd-list-item-text-three-line-height,
    value: $item-secondary-text-three-line-max-height,
  ),
);

@function get-var($name, $fallback: null) {
  $found: utils.validate($var-lookup, $name, "list var");
  $var: map.get($found, var);
  $value: if($fallback, $fallback, map.get($found, value));

  @if $value {
    @return var(#{$var}, #{$value});
  }

  @return var(#{$var});
}

@mixin set-var($name, $value) {
  $var: map.get(utils.validate($var-lookup, $name, "list var"), var);

  #{$var}: #{$value};
}

@mixin use-var($property, $name: $property, $fallback: null) {
  #{$property}: get-var($name, $fallback);
}

@mixin _addon-spacing($subtract) {
  $keyline: get-var(item-keyline);
  $padding: get-var(item-horizontal-padding);

  @include icon.set-var(
    spacing,
    calc(#{$keyline} - #{$padding} - #{$subtract})
  );
}

@mixin styles {
  @if not $disable-everything {
    .rmd-list {
      @include utils.map-to-styles($typography-styles);
      @include divider.set-var(inset, get-var(item-keyline));

      list-style: none;
      margin: 0;
      padding: get-var(vertical-padding) get-var(horizontal-padding);

      @if not $disable-horizontal {
        &--horizontal {
          display: flex;
          flex-wrap: nowrap;
          max-width: 100%;
          overflow: auto;
          padding: get-var(horizontal-padding) get-var(vertical-padding);
        }
      }
    }

    .rmd-list-item {
      @include use-var(min-height, item-height);

      align-items: center;
      display: flex;
      padding: get-var(item-vertical-padding) get-var(item-horizontal-padding);

      &--clickable {
        @include interaction.surface(
          $disabled-selector: '&[aria-disabled="true"]'
        );
      }

      @if not $disable-item-link-styles {
        &--link {
          color: inherit;
          text-decoration: none;
        }
      }

      @if not $disable-item-disabled-color {
        &--disabled-color {
          @include theme.theme-set-var(
            text-secondary-color,
            theme.theme-get-var(text-disabled-color)
          );
          @include theme.theme-use-var(color, text-disabled-color);
        }
      }

      @if not $disable-item-disabled-opacity {
        &--disabled-opacity {
          opacity: $item-disabled-opacity;
        }
      }

      @if not $disable-medium-height {
        &--medium {
          @include set-var(item-height, get-var(item-medium-height));
        }
      }

      @if not $disable-large-height {
        &--large {
          @include set-var(item-height, get-var(item-large-height));
        }
      }

      @if not $disable-extra-large-height {
        &--extra-large {
          @include set-var(item-height, get-var(item-extra-large-height));
        }
      }

      @if not $disable-three-line-height {
        &--three-lines {
          @include set-var(item-height, get-var(item-three-line-height));
        }
      }

      &__text {
        @include typography.text-overflow;
        @include utils.rtl {
          margin-left: auto;
        }

        display: block;
        flex-grow: 1;

        &--secondary {
          @include theme.theme-use-var(color, text-secondary-color);
        }

        &--clamped {
          @include typography.line-clamp;
          @include use-var(max-height, text-three-line-height);

          line-height: $item-secondary-text-line-height;
          white-space: normal;
        }
      }

      &__addon {
        flex-shrink: 0;

        &--top {
          align-self: flex-start;
        }

        &--bottom {
          align-self: flex-end;
        }

        &--before {
          @include _addon-spacing(icon.get-var(size));
        }

        @if not $disable-item-avatar {
          &--avatar-before {
            @include _addon-spacing(avatar.get-var(size));
          }
        }

        @if not $disable-item-media {
          &--media {
            @include icon.set-var(spacing, get-var(item-media-spacing));
            @include use-var(width, item-media-size);
          }

          &--media-centered {
            align-items: center;
            display: flex;
            justify-content: center;
          }

          @if not $disable-item-media-large {
            &--media-large {
              @include set-var(item-media-size, $item-media-large-size);
            }
          }
        }
      }
    }

    @if not $disable-subheader {
      .rmd-list-subheader {
        @include utils.map-to-styles(typography.$subtitle-2-styles);
        @include theme.theme-use-var(color, text-secondary-color);
        @include use-var(height, item-height);

        align-items: center;
        display: flex;
        padding: get-var(item-vertical-padding)
          get-var(item-horizontal-padding);

        @if not $disable-subheader-inset {
          &--inset {
            @include utils.rtl {
              @include use-var(padding-left, item-horizontal-padding);
              @include use-var(padding-right, item-keyline);
            }

            @include use-var(padding-left, item-keyline);
          }
        }
      }
    }
  }
}
