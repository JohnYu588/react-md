@use "sass:list" as sassList;
@use "sass:map";
@use "../utils";
@use "../icon/icon";
@use "../list/list";
@use "../typography/typography";
@use "../interaction/interaction";

$disable-expander-left: false !default;
$disable-expander-left-as-media: false !default;
$disable-expander-left-as-media-offset: false !default;
$disable-selected-background-color: false !default;

$padding-incrementor: list.$item-horizontal-padding * 1.5 !default;
$padding-base: list.get-var(item-keyline) !default;
$expander-right-from: icon.$rotate-from !default;
$expander-right-to: 90deg !default;
$expander-left-from: 0deg !default;
$expander-left-to: -90deg !default;

$selected-styles: (
  font-weight: typography.$font-weight-bold,
) !default;

$var-lookup: (
  depth: (
    var: --rmd-tree-depth,
    value: -1,
  ),
  item-padding: (
    var: --rmd-tree-item-padding,
    value: 0,
  ),
  padding-base: (
    var: --rmd-tree-item-padding-base,
    value: $padding-base,
  ),
  padding-incrementor: (
    var: --rmd-tree-item-padding-incrementor,
    value: $padding-incrementor,
  ),
);

@function get-var($name, $fallback: null) {
  $found: utils.validate($var-lookup, $name, "tree var");
  $var: map.get($found, var);
  $value: if($fallback, $fallback, map.get($found, value));

  @if $value {
    @return var(#{$var}, #{$value});
  }

  @return var(#{$var});
}

@mixin set-var($name, $value) {
  $var: map.get(utils.validate($var-lookup, $name, "tree var"), var);

  #{$var}: #{$value};
}

@mixin use-var($property, $name: $property, $fallback: null) {
  #{$property}: get-var($name, $fallback);
}

@mixin styles {
  .rmd-tree {
    display: block;
    height: 100%;
    outline-style: none;
    overflow: auto;
    // this is mostly for firefox. moving the mouse even 1px while clicking will
    // select the current item and all items to the tree root
    user-select: none;
    width: 100%;
  }

  .rmd-tree-item {
    @include icon.set-var(rotate-from, $expander-right-from);
    @include icon.set-var(rotate-to, $expander-right-to);
    @include set-var(
      item-padding,
      calc(
        get-var(depth) * get-var(padding-incrementor) + get-var(padding-base)
      )
    );

    list-style: none;

    @if not $disable-expander-left {
      &--expander-left {
        @include icon.set-var(rotate-from, $expander-left-from);
        @include icon.set-var(rotate-to, $expander-left-to);
      }
    }

    &__content {
      &--disabled {
        cursor: auto;

        &:hover::before {
          @include interaction.set-var(background-color, transparent);
        }
      }

      &--link {
        color: inherit;
        text-decoration: none;
      }

      &--padded {
        @include utils.auto-rtl(
          padding-left,
          get-var(item-padding),
          list.get-var(item-horizontal-padding)
        );
      }

      &--focused::before {
        .rmd-tree:focus-within & {
          @include utils.keyboard-only {
            @include interaction.focus-styles;
          }
        }
      }

      @if $selected-styles {
        &--selected {
          @if not $disable-selected-background-color {
            @include interaction.set-var(
              background-color,
              interaction.get-var(selected-background-color)
            );

            @include utils.touch-only {
              &:hover::before {
                @include interaction.set-var(
                  background-color,
                  interaction.get-var(selected-background-color)
                );
              }
            }
          }
          @include utils.map-to-styles($selected-styles);
        }
      }
    }

    @if not $disable-expander-left-as-media {
      &__media {
        align-items: center;
        display: flex;
        justify-content: space-between;

        @if not $disable-expander-left-as-media-offset {
          &--single {
            justify-content: flex-end;
          }
        }
      }
    }
  }

  .rmd-tree-group {
    background-color: inherit;
    color: inherit;
    font-size: inherit;
    line-height: inherit;

    // remove the list padding to make it more condensed
    padding-bottom: 0;
    padding-top: 0;
  }
}
