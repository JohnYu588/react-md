@use "sass:map";

@use "../utils";
@use "../theme/theme";
@use "../transition/transition";
@use "../typography/typography";
@use "../interaction/interaction";
@use "../icon/icon";
@use "../button/button";

$disable-everything: false !default;
$disable-icon: false !default;
$disable-stacked: false !default;
$disable-reversed: false !default;
$disable-tablist-padded: false !default;
$disable-tablist-vertical: false !default;
$disable-tablist-indicator: false !default;
$disable-tablist-hidden-scrollbar: false !default;
$disable-tablist-scroll-button: false !default;
$disable-tablist-active-indicator-transition: false !default;
$disable-tablist-scroll-button-vertical: $disable-tablist-vertical !default;
$disable-indicator: false !default;
$disable-indicator-vertical: $disable-tablist-vertical !default;

$typography: map.remove(typography.$button-styles, line-height) !default;
$gap: icon.$spacing !default;
$height: 3rem !default;
$stacked-height: 4.5rem !default;
$horizontal-padding: 1rem !default;
$vertical-padding: 0.75rem !default;
$min-width: 5.625rem !default;
$max-width: 20rem !default;
$indicator-height: 0.125rem !default;
$indicator-background: theme.theme-get-var(primary-color) !default;
$active-color: theme.theme-get-var(text-primary-color) !default;
$inactive-color: theme.theme-get-var(text-secondary-color) !default;
$disabled-color: theme.theme-get-var(text-disabled-color) !default;
$transition-duration: transition.$linear-duration !default;
$transition-timing-function: transition.$linear-timing-function !default;

$tablist-padding-left: 3.25rem !default;
$tablist-scroller-z-index: 2 !default;
$tablist-scroller-background-color: theme.theme-get-var(
  background-color,
  inherit
) !default;
$tablist-vertical-indicator-left: 0 !default;
$tablist-button-border-radius: 0 !default;

$variables: (
  color,
  active-color,
  inactive-color,
  disabled-color,
  indicator-background,
  min-height,
  max-width,
  min-width,
  stacked-height,
  stacked-width,
  padding,
  stacked-padding
);

@function get-var($name, $fallback: null) {
  $var: utils.get-var-name($variables, $name, "tab");
  @if $fallback {
    @return var(#{$var}, #{$fallback});
  }

  @return var(#{$var});
}

@mixin set-var($name, $value) {
  @if $value {
    #{utils.get-var-name($variables, $name, "tab")}: #{$value};
  }
}

@mixin use-var($property, $name: $property, $fallback: null) {
  #{$property}: get-var($name, $fallback);
}

@mixin indicator-styles {
  .rmd-tab-indicator {
    &::after {
      @include use-var(background, indicator-background);

      content: "";
      pointer-events: none;
      position: absolute;
      z-index: 1;
    }

    &--h::after {
      bottom: 0;
      height: $indicator-height;
      width: 100%;
    }

    @if not $disable-indicator-vertical {
      &--v::after {
        height: 100%;
        left: $tablist-vertical-indicator-left;
        top: 0;
        width: $indicator-height;

        @include utils.rtl {
          left: auto;
          right: $tablist-vertical-indicator-left;
        }
      }
    }

    @if not $disable-tablist-indicator {
      &--tablist-h::after {
        left: 0;
        max-width: var(--rmd-tab-size, $min-width);
        transform: translateX(var(--rmd-tab-offset, 0));
      }

      @if not $disable-tablist-vertical {
        &--tablist-v::after {
          max-height: var(--rmd-tab-size, $min-width);
          transform: translateY(var(--rmd-tab-offset, 0));
        }
      }
    }

    @if not $disable-tablist-active-indicator-transition {
      &--animate::after {
        transition-duration: $transition-duration;
        transition-property: transform, max-width;
        transition-timing-function: $transition-timing-function;
      }
    }
  }
}

@mixin tablist-styles {
  .rmd-tablist {
    display: inline-flex;
    // disable shrinking since tabs should normally be full width and this
    // also fixes issues when placed within a flex column container
    flex-shrink: 0;
    flex-wrap: nowrap;
    // make sure it can enable scrollbars in flex/grid containers
    max-width: 100%;
    outline: none;
    overflow: auto;
    position: relative;

    &--full-width {
      display: flex;
      width: 100%;
    }

    &--full-width-tabs {
      @include set-var(min-width, none);
    }

    @if not $disable-tablist-hidden-scrollbar {
      &--no-scrollbar {
        @include utils.hide-scrollbar;
      }
    }

    @if not $disable-tablist-vertical {
      &--vertical {
        flex-direction: column;
      }
    }

    @if not $disable-tablist-padded {
      &--padded {
        padding-left: $tablist-padding-left;

        @include utils.rtl {
          padding-left: 0;
          padding-right: $tablist-padding-left;
        }
      }
    }

    &--center {
      justify-content: center;
    }
  }
}

@mixin tablist-button-styles {
  .rmd-tablist-button {
    @include button.set-var(icon-border-radius, $tablist-button-border-radius);

    align-items: center;
    background-color: $tablist-scroller-background-color;
    display: inline-flex;
    flex-shrink: 0;
    justify-content: center;
    max-width: $max-width;
    position: sticky;
    z-index: $tablist-scroller-z-index;

    &--left {
      left: 0;
    }

    &--right {
      right: 0;
    }

    @if not $disable-tablist-scroll-button-vertical {
      &--above {
        top: 0;
      }

      &--below {
        bottom: 0;
      }
    }

    &__button {
      @if not $disable-tablist-scroll-button-vertical {
        &--v {
          transform: rotate(90deg);
        }
      }
    }

    @include utils.rtl {
      &--left {
        left: auto;
        right: 0;
      }

      &--right {
        left: 0;
        right: auto;
      }

      &__button {
        transform: rotate(180deg);
      }
    }
  }
}

@mixin tab-styles {
  .rmd-tab {
    @include utils.map-to-styles($typography);
    @include use-var(color);
    @include use-var(min-height);
    @include use-var(max-width);
    @include use-var(min-width);
    @include use-var(padding);
    @if not $disable-icon {
      @include icon.set-var(color, currentcolor);
    }

    align-items: center;
    background-color: transparent;
    border-width: 0;
    display: inline-flex;
    flex: 1 0 auto;
    gap: $gap;
    justify-content: center;
    transition: color $transition-duration $transition-timing-function;

    @if not $disable-stacked {
      &--stacked {
        @include use-var(height, stacked-height);
        @include use-var(padding, stacked-padding);

        flex-direction: column;
      }

      @if not $disable-reversed {
        &--stacked-reversed {
          flex-direction: column-reverse;
        }
      }
    }

    @if not $disable-reversed {
      &--reversed {
        flex-direction: row-reverse;
      }
    }

    &--active {
      @include set-var(color, get-var(active-color));
    }

    &--disabled {
      @include set-var(color, get-var(disabled-color));
    }
  }
}

@mixin variables {
  @if not $disable-everything {
    @include set-var(color, $inactive-color);
    @include set-var(active-color, $active-color);
    @include set-var(inactive-color, $inactive-color);
    @include set-var(disabled-color, $disabled-color);
    @include set-var(min-height, $height);
    @include set-var(max-width, $max-width);
    @include set-var(min-width, $min-width);
    @include set-var(padding, 0 $horizontal-padding);

    @if not $disable-stacked {
      @include set-var(stacked-height, $stacked-height);
      @include set-var(stacked-padding, $vertical-padding $horizontal-padding);
    }

    @if not $disable-indicator {
      @include set-var(indicator-background, $indicator-background);
    }
  }
}

@mixin styles($disable-layer: false) {
  @if not $disable-everything {
    @include utils.optional-layer(tabs, $disable-layer) {
      @include tablist-styles;
      @include tab-styles;

      @if not $disable-indicator {
        @include indicator-styles;
      }

      @if not $disable-tablist-scroll-button {
        @include tablist-button-styles;
      }
    }
  }
}
