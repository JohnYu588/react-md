@use "sass:map";
@use "../utils";
@use "../box-shadows";
@use "../transition/transition";
@use "../interaction/interaction";
@use "../theme/theme";

$disable-everything: false !default;
$disable-fixed: false !default;
$disable-focus-outline: false !default;
$disable-footer-flex-vertical: false !default;
$disable-footer-flex-start: false !default;
$disable-footer-space-between: false !default;
$disable-footer-flex-end: false !default;

$elevation: 16 !default;
$z-index: utils.$temporary-element-z-index !default;

$background-color: theme.theme-get-var(surface-color) !default;
$color: theme.theme-get-var(text-primary-color) !default;

$min-width: 17.5rem !default;
$horizontal-margin: 2.5rem !default;
$vertical-margin: 1.5rem !default;
$transition-distance: 1.875rem !default;

$enter-duration: transition.$enter-duration !default;
$enter-timing-function: transition.$deceleration-timing-function !default;
$leave-timing-function: transition.$acceleration-timing-function !default;
$leave-duration: transition.$leave-duration !default;

$header-padding: 1.5rem !default;
$header-padding-bottom: 1.25rem !default;

$content-padding: 1.5rem !default;

$footer-padding: 0.5rem !default;

$var-lookup: (
  background-color: (
    var: --rmd-dialog-background-color,
    value: $background-color,
  ),
  color: (
    var: --rmd-dialog-color,
    value: $color,
  ),
  min-width: (
    var: --rmd-dialog-min-width,
    value: $min-width,
  ),
  horizontal-margin: (
    var: --rmd-dialog-h-margin,
    value: $horizontal-margin,
  ),
  vertical-margin: (
    var: --rmd-dialog-v-margin,
    value: $vertical-margin,
  ),
  z-index: (
    var: --rmd-dialog-z-index,
    value: $z-index,
  ),
  header-padding: (
    var: --rmd-dialog-header-padding,
    value: $header-padding,
  ),
  header-padding-bottom: (
    var: --rmd-dialog-header-padding-bottom,
    value: $header-padding-bottom,
  ),
  content-padding: (
    var: --rmd-dialog-content-padding,
    value: $content-padding,
  ),
  footer-padding: (
    var: --rmd-dialog-footer-padding,
    value: $footer-padding,
  ),
);

@function get-var($name, $fallback: null) {
  $found: utils.validate($var-lookup, $name, "dialog var");
  $var: map.get($found, var);
  $value: if($fallback, $fallback, map.get($found, value));

  @if $value {
    @return var(#{$var}, #{$value});
  }

  @return var(#{$var});
}

@mixin set-var($name, $value) {
  $var: map.get(utils.validate($var-lookup, $name, "dialog var"), var);

  #{$var}: #{$value};
}

@mixin use-var($property, $name: $property, $fallback: null) {
  #{$property}: get-var($name, $fallback);
}

@mixin styles {
  @if not $disable-everything {
    .rmd-dialog-container {
      @include use-var(z-index);

      align-items: center;
      display: flex;
      inset: 0;
      justify-content: center;
      margin: get-var(vertical-margin) get-var(horizontal-margin);
      margin-right: calc(
        #{get-var(horizontal-margin)} + #{utils.scrollbar-size()}
      );
      position: fixed;
      pointer-events: none;
    }

    .rmd-dialog {
      @include box-shadows.box-shadow($elevation);
      @include use-var(background-color);
      @include use-var(color);

      display: flex;
      flex-direction: column;
      max-height: 100%;
      max-width: 100%;
      outline: none;

      &--centered {
        @include use-var(min-width);

        pointer-events: auto;
      }

      &--full-page {
        @include use-var(z-index);

        height: 100%;
        inset: 0;
        overflow: auto;
        position: fixed;
        width: 100%;
      }

      @if not $disable-focus-outline {
        @include utils.keyboard-only {
          &--outline:focus {
            // Note: Do not use the `interaction-outline` mixin +
            // `interaction-set-var(interaction.$outline-color)` like normal focus
            // elements since it'll make all focusable children update with the
            // outline color as well
            outline: interaction.get-var(outline-color) solid
              interaction.get-var(outline-width);
          }
        }
      }

      &--enter {
        transform: translateY($transition-distance);
      }

      &--enter-active {
        transform: translateY(0);
        transition: transform $enter-duration;
        transition-timing-function: $enter-timing-function;
      }

      &--exit {
        opacity: 1;
        transform: translateY(0);
        transition: transform $leave-duration, opacity $leave-duration;
        transition-timing-function: $leave-timing-function;
      }

      &--exit-active {
        opacity: 0;
        transform: translateY($transition-distance);
      }

      @if not $disable-fixed {
        &--fixed {
          @include use-var(z-index);
        }
      }

      &__header {
        @include use-var(padding, header-padding);
        @include use-var(padding-bottom, header-padding-bottom);

        align-items: center;
        display: flex;
        flex: 0 0 auto;
      }

      &__title {
        // this makes it so it's easy to add a close button after the title
        flex: 1 1 auto;
      }

      &__content {
        flex: 1 1 auto;
        overflow: auto;

        &--padded {
          @include use-var(padding, content-padding);
        }
      }

      &__footer {
        @include use-var(padding, footer-padding);

        flex: 0 0 auto;

        @if not
          $disable-footer-flex-vertical or not
          $disable-footer-flex-start or not
          $disable-footer-space-between or not
          $disable-footer-flex-end
        {
          &--flex {
            display: flex;
          }
        }

        @if not $disable-footer-flex-vertical {
          &--flex-v {
            flex-direction: column;
          }
        }

        @if not $disable-footer-flex-start {
          &--start {
            justify-content: flex-start;
          }
        }

        @if not $disable-footer-space-between {
          &--between {
            justify-content: space-between;
          }
        }

        @if not $disable-footer-flex-end {
          &--end {
            justify-content: flex-end;
          }
        }
      }
    }
  }
}
