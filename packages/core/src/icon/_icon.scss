@use "sass:color";
@use "../theme/theme";
@use "../transition/transition";
@use "../utils";

$disable-font: false !default;
$disable-svg: false !default;
$disable-symbol: false !default;
$disable-dense: false !default;
$disable-inline: false !default;
$disable-spacing-before: false !default;
$disable-spacing-after: false !default;
$disable-spacing-above: false !default;
$disable-spacing-below: false !default;
$disable-rotator: false !default;

$light-theme-color: color.adjust(#000, $lightness: 46%) !default;
$dark-theme-color: color.adjust(#fff, $lightness: -30%) !default;

$color: theme.get-default-color($light-theme-color, $dark-theme-color) !default;

$size: 1.5rem !default;
$dense-size: 1.25rem !default;

$symbol-fill: 0 !default;
$symbol-weight: 400 !default;
$symbol-grade: 0 !default;
$symbol-optical-size: 48 !default;

$_validated-fill: utils.validate((0, 1), $symbol-fill, "$symbol-fill");
$_validated_weight: utils.validate(
  (100 200 300 400 500 600 700),
  $symbol-weight,
  "$symbol-weight"
);
$_validated_grade: utils.validate((-25 0 200), $symbol-grade, "$symbol-grade");
$_validated_optical-size: utils.validate(
  (20 24 40 48),
  $symbol-optical-size,
  "$symbol-optical-size"
);

$spacing: 0.5rem !default;

$rotate-from: 0deg !default;
$rotate-to: 180deg !default;
$rotate-duration: transition.$linear-duration !default;

$variables: (
  color,
  size,
  spacing,
  rotate-from,
  rotate-to,
  symbol-fill,
  symbol-grade,
  symbol-weight,
  symbol-optical-size
);

// shouldn't really use react-md without icons though...
$_disable-icons: $disable-font and $disable-svg and $disable-symbol;

@function get-var($name, $fallback: null) {
  $var: utils.get-var-name($variables, $name, "icon");
  @if $fallback {
    @return var(#{$var}, #{$fallback});
  }

  @return var(#{$var});
}

@mixin set-var($name, $value) {
  @if $value {
    #{utils.get-var-name($variables, $name, "icon")}: #{$value};
  }
}

@mixin use-var($property, $name: $property, $fallback: null) {
  #{$property}: get-var($name, $fallback);
}

@mixin use-light-theme {
  @if not $_disable-icons {
    @include set-var(color, $light-theme-color);
  }
}

@mixin use-dark-theme {
  @if not $_disable-icons {
    @include set-var(color, $dark-theme-color);
  }
}

@mixin dense {
  @if $dense-size {
    @include set-var(size, $dense-size);
  }
}

@mixin variables {
  @if not $_disable-icons {
    @include set-var(color, $color);
    @include set-var(size, $size);
    @include set-var(spacing, $spacing);
  }

  @if not $disable-symbol {
    @include set-var(symbol-fill, $symbol-fill);
    @include set-var(symbol-grade, $symbol-grade);
    @include set-var(symbol-weight, $symbol-weight);
    @include set-var(symbol-optical-size, $symbol-optical-size);
  }

  @if not $disable-rotator {
    @include set-var(rotate-from, $rotate-from);
    @include set-var(rotate-to, $rotate-to);
  }
}

@mixin styles($disable-layer: false) {
  @if not $_disable-icons {
    @include utils.optional-layer(icon, $disable-layer) {
      @include theme.default-system-theme {
        @include use-dark-theme;
      }

      .rmd-icon {
        @include use-var(font-size, size);
        @include use-var(color);

        // you normally don't want icons to shrink in flex containers.
        // update the icon manually instead.
        flex-shrink: 0;
        user-select: none;

        @if not $disable-font {
          &--font {
            text-align: center;
          }
        }

        @if not $disable-svg {
          &--svg {
            fill: currentcolor;
            height: 1em;
            width: 1em;
          }
        }

        @if not $disable-symbol {
          &--symbol {
            font-variation-settings:
              "FILL" get-var(symbol-fill),
              "wght" get-var(symbol-weight),
              "GRAD" get-var(symbol-grade),
              "opsz" get-var(symbol-optical-size);
          }
        }

        @if not $disable-inline {
          &--vab {
            vertical-align: bottom;
          }
        }

        @if not $disable-spacing-before {
          &--before {
            @include utils.auto-rtl(margin-right, get-var(spacing), 0);
          }
        }

        @if not $disable-spacing-after {
          &--after {
            @include utils.auto-rtl(margin-left, get-var(spacing), 0);
          }
        }

        @if not $disable-spacing-above {
          &--above {
            @include use-var(margin-bottom, spacing);
          }
        }

        @if not $disable-spacing-below {
          &--below {
            @include use-var(margin-top, spacing);
          }
        }

        @if not $disable-dense {
          &--dense {
            @include set-var(size, $dense-size);
          }
        }
      }
    }

    @if not $disable-rotator {
      .rmd-icon-rotator {
        transform: rotate(get-var(rotate-from));

        &--animate {
          transition: transform $rotate-duration linear;
        }

        &--rotated {
          transform: rotate(get-var(rotate-to));
        }
      }
    }
  }
}
