@use "sass:map";
@use "@react-md/core";
@use "@react-md/icon";

$disable-icon: false !default;
$disable-image: false !default;

$color: core.$grey-100 !default;
$background-color: core.$grey-700 !default;
$line-height: map.get(core.$subtitle-1-styles, line-height) !default;
$border-radius: 50% !default;
$size: 2.5rem !default;
$font-size: 1.5rem !default;

$colors: (
  red: core.$red-a-700 core.$red-50,
  pink: core.$pink-600 core.$white-base,
  purple: core.$purple-700 core.$purple-100,
  deep-purple: core.$deep-purple-900 core.$deep-purple-100,
  indigo: core.$indigo-600 core.$indigo-100,
  blue: core.$blue-a-700 core.$white-base,
  light-blue: core.$light-blue-300 core.$deep-purple-900,
  cyan: core.$cyan-400 core.$teal-900,
  teal: core.$teal-a-400 core.$teal-900,
  green: core.$green-800 core.$green-50,
  light-green: core.$light-green-300 core.$green-900,
  lime: core.$lime-400 core.$teal-800,
  yellow: core.$yellow-a-200 core.$brown-500,
  amber: core.$amber-400 core.$brown-800,
  orange: core.$orange-600 core.$grey-900,
  deep-orange: core.$deep-orange-a-400 core.$grey-900,
  brown: core.$brown-500 core.$brown-50,
  grey: core.$grey-700 core.$grey-100,
  blue-grey: core.$blue-grey-700 core.$blue-grey-50,
) !default;

$var-lookup: (
  background-color: (
    var: --rmd-avatar-background-color,
    value: $background-color,
  ),
  color: (
    var: --rmd-avatar-color,
    value: $color,
  ),
  border-color: (
    var: --rmd-avatar-border-color,
    value: transparent,
  ),
  border-radius: (
    var: --rmd-avatar-border-radius,
    value: $border-radius,
  ),
  size: (
    var: --rmd-avatar-size,
    value: $size,
  ),
  font-size: (
    var: --rmd-avatar-font-size,
    value: $font-size,
  ),
);

@function get-var($name, $fallback: null) {
  $found: core.validate($var-lookup, $name, "avatar var");
  $var: map.get($found, var);
  $value: if($fallback, $fallback, map.get($found, value));

  @if $value {
    @return var(#{$var}, #{$value});
  }

  @return var(#{$var});
}

@mixin set-var($name, $value) {
  $var: map.get(core.validate($var-lookup, $name, "avatar var"), var);

  #{$var}: #{$value};
}

@mixin use-var($property, $name: $property, $fallback: null) {
  #{$property}: get-var($name, $fallback);
}

@mixin custom-color($name, $color, $background-color, $disable-prefix: false) {
  $class-name: if($disable-prefix, $name, ".rmd-avatar--#{$name}");

  #{$class-name} {
    @include set-var(background-color, $background-color);
    @include set-var(color, $color);
  }
}

@mixin styles {
  .rmd-avatar {
    @if not $disable-icon {
      @include icon.set-var(color, currentcolor);
    }
    @include core.map-to-styles(core.$base-font-styles);
    @include use-var(background-color);
    @include use-var(border-radius);
    @include use-var(color);
    @include use-var(font-size);
    @include use-var(height, size);
    @include use-var(width, size);

    align-items: center;
    border: 1px solid get-var(border-color);
    display: inline-flex;
    flex-shrink: 0;
    justify-content: center;
    line-height: $line-height;
    overflow: hidden;

    @if not $disable-image {
      &__image {
        height: 100%;
        width: auto;
      }
    }

    @each $name, $values in $colors {
      @if length($values) != 2 {
        @error 'Unable to create an avatar color because the list of values is not of length 2. The first value should be the background-color and the second should be the text color. "#{$values}"';
      }

      @include custom-color(
        "&--#{$name}",
        nth($values, 2),
        nth($values, 1),
        true
      );
    }
  }
}
