import { writeFile } from "node:fs/promises";
import { format } from "prettier";

import { logComplete } from "./log.js";

export const GENERATED_FILE_BANNER =
  "// THIS FILE WAS GENERATED BY A SCRIPT AND SHOULD NOT BE UPDATED MANUALLY";

export function getAliasedFileName(fileName: string): string {
  return fileName.replace(/^.+src\//, "@/");
}

interface WriteOptions {
  log?: boolean;
  fileName: string;
  contents: string;
}

export async function writeGeneratedFile(options: WriteOptions): Promise<void> {
  const { log = true, fileName, contents } = options;
  await writeFile(
    fileName,
    await format(
      `${GENERATED_FILE_BANNER}

${contents}
`,
      { filepath: fileName }
    )
  );
  if (log) {
    logComplete(`Generated "${getAliasedFileName(fileName)}"`);
  }
}
